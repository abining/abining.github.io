---
layout: post
categories: [tools] # æ–‡ç« åˆ†ç±»ï¼Œtagsçš„æ›¿ä»£
author: abining
title: ä½¿ç”¨nginxæŠŠæ‰“åŒ…å¥½çš„ç½‘é¡µæ–‡ä»¶éƒ¨ç½²åœ¨æœ¬åœ°çš„ç«¯å£é‡Œé¢
date: 2024-12-30 00:00:02
header-style: text
catalog: true
tags:
  - å‰ç«¯å¼€å‘
  - nginx
  - mac
---

ä½¿ç”¨ Nginx åœ¨ macOS ä¸Šæœ¬åœ°éƒ¨ç½² Vue é¡¹ç›®ï¼Œä¾›å±€åŸŸç½‘è®¿é—®

## ğŸš§ èƒŒæ™¯

å…¬å¸æ²¡æœ‰ä¸“é—¨çš„æµ‹è¯•ç¯å¢ƒï¼Œäº§å“åŒäº‹éœ€è¦é¢‘ç¹éªŒè¯å¤šä¸ª Vue é¡¹ç›®çš„å‰ç«¯é¡µé¢ã€‚ä½†ï¼š

- å„é¡¹ç›®ä½¿ç”¨ä¸åŒ Node ç‰ˆæœ¬ï¼Œåˆ‡æ¢ç¯å¢ƒéå¸¸éº»çƒ¦
- ç¼ºå°‘æ ‡å‡†çš„ç»Ÿä¸€éƒ¨ç½²æ–¹å¼

äºæ˜¯æˆ‘å†³å®šä½¿ç”¨ **Nginx å¯åŠ¨æœ¬åœ° HTTP æœåŠ¡** ï¼Œéƒ¨ç½² Vue æ‰“åŒ…äº§ç‰©å¹¶æš´éœ²ç«¯å£ï¼Œä¾›å±€åŸŸç½‘ä¸­çš„å…¶ä»–è®¾å¤‡è®¿é—®ã€‚

## 1ï¸âƒ£ å®‰è£… Nginxï¼ˆå·²é€šè¿‡ Homebrewï¼‰

ä½ ä½¿ç”¨ Homebrew å®‰è£… Nginxï¼š

```bash
brew install nginx
```

## 2ï¸âƒ£ æ‰¾åˆ° nginx.conf é…ç½®è·¯å¾„

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥é…ç½®å¹¶æŸ¥çœ‹è·¯å¾„ï¼š

```bash
nginx -t
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
nginx: the configuration file /opt/homebrew/etc/nginx/nginx.conf syntax is ok
nginx: configuration file /opt/homebrew/etc/nginx/nginx.conf test is successful
```

è®°å½•ä¸‹è¯¥è·¯å¾„ï¼š

ğŸ“Œ `/opt/homebrew/etc/nginx/nginx.conf`

## 3ï¸âƒ£ æ›¿æ¢é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨è½¯é“¾æ¥ï¼‰

å¦‚æœé¡¹ç›®ä¸­å·²ç»å‡†å¤‡äº†è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š

`/Users/mac/code/work-company/plugins/nginx-conf/nginx.conf`

å¯ç”¨è½¯é“¾æ¥æ›¿æ¢é»˜è®¤é…ç½®ï¼š

```bash
sudo ln -sf /Users/mac/code/work-company/plugins/nginx-conf/nginx.conf /opt/homebrew/etc/nginx/nginx.conf
```

å¦‚éœ€å–æ¶ˆé“¾æ¥ï¼š

```bash
sudo rm /opt/homebrew/etc/nginx/nginx.conf
```

## 4ï¸âƒ£ ç¤ºä¾‹é…ç½®ï¼ˆç›‘å¬ 8080ï¼Œé€‚åˆæœ¬åœ°å¼€å‘ï¼‰

ä»¥ä¸‹é…ç½®æ–°å¢äº†ä¸€ä¸ª `server` å—ï¼Œç”¨äºç›‘å¬ç«¯å£ 8080ï¼ŒæœåŠ¡é™æ€èµ„æºï¼Œå¹¶å°†éƒ¨åˆ†è¯·æ±‚ä»£ç†åˆ°åç«¯ï¼š

```nginx
events {
    worker_connections 1024;
}

http {
    include mime.types;
    default_type application/octet-stream;

    server {
        listen 8080;
        server_name localhost;  # æˆ– 0.0.0.0ï¼ˆå…è®¸å…¶ä»–è®¾å¤‡è®¿é—®ï¼‰

        root /Users/mac/code/work-company/dist;
        index index.html index.htm;

        location / {
            try_files $uri $uri/ /index.html;
        }

        location /industry-web {
            proxy_pass http://192.168.10.132:8002/industry-web;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root html;
        }
    }
}
```

### ğŸ“Œ é…ç½®è¯´æ˜ï¼š

- `listen 8080`ï¼šä½¿ç”¨éç‰¹æƒç«¯å£ï¼Œæ— éœ€ sudo å¯åŠ¨
- `root ...`ï¼šæŒ‡å‘ä½ çš„ Vue æ‰“åŒ…äº§ç‰©ç›®å½•
- `location /`ï¼šæ”¯æŒ Vue çš„ history æ¨¡å¼è·¯ç”±
- `proxy_pass`ï¼šå°†æ¥å£è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡
- `server_name`ï¼šç”¨ `localhost`ï¼šä»…æœ¬æœºè®¿é—®

## ğŸ’¡ å¦‚ä½•é›†æˆåˆ°åŸå§‹é…ç½®ï¼Ÿ

ä½ æ— éœ€æ”¹åŠ¨å…¶ä»–é…ç½®ï¼Œåªéœ€ï¼š

- æ‰¾åˆ° nginx.conf çš„ `http {}` å—
- åœ¨é‡Œé¢ **è¿½åŠ ä¸€ä¸ªæ–°çš„ `server` å—** ï¼ˆå¦‚ä¸Šæ‰€ç¤ºï¼‰

å¦‚æœä½ æœ‰å¤šä¸ªé¡¹ç›®ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªä¸åŒç«¯å£çš„ `server` å—ï¼Œä¸€å¥—é…ç½®æå®šã€‚

## å…¶ä»–å†…å®¹

### Nginx å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤                                       | è¯´æ˜                          |
| ------------------------------------------ | ----------------------------- |
| `sudo nginx -t`                            | æ£€æŸ¥é…ç½®è¯­æ³•                  |
| `sudo nginx`æˆ– `brew services start nginx` | å¯åŠ¨æœåŠ¡                      |
| `sudo nginx -s reload`                     | é‡è½½é…ç½®ï¼ˆä¸ä¼šä¸­æ–­è¿æ¥ï¼‰      |
| `sudo nginx -s stop`                       | å¼ºåˆ¶åœæ­¢                      |
| `sudo nginx -s quit`                       | ä¼˜é›…é€€å‡ºï¼ˆç­‰å½“å‰è¯·æ±‚å¤„ç†å®Œï¼‰  |
| `brew services stop nginx`                 | åœæ­¢åå°æœåŠ¡ï¼ˆbrew ç®¡ç†æ–¹å¼ï¼‰ |

### sudo ä¸é sudo å¯åŠ¨å†²çªè¯´æ˜

| å¯åŠ¨æ–¹å¼                  | æ˜¯å¦éœ€è¦ sudo             | è¯´æ˜                                    |
| ------------------------- | ------------------------- | --------------------------------------- |
| sudo nginx                | âœ… æ˜¯                     | å¯ç”¨ root æƒé™ï¼Œæ‰èƒ½ç›‘å¬ 80ã€443 ç­‰ç«¯å£ |
| nginxï¼ˆæ—  sudoï¼‰          | âœ… ä»…åœ¨ç«¯å£ â‰¥ 1024 æ—¶å¯ç”¨ | æ¨èç”¨äºå¼€å‘ï¼ˆä¾‹å¦‚ 8080ã€5500ï¼‰         |
| brew services start nginx | âœ…                        | åå°å®ˆæŠ¤è¿›ç¨‹ï¼Œç”±ç³»ç»Ÿç®¡ç†ï¼Œç»Ÿä¸€æƒé™      |
| ---                       | ---                       | ---                                     |
|                           |                           |                                         |

ğŸ“Œ **æ³¨æ„** ï¼šä¸è¦æ··ç”¨ `sudo nginx` å’Œé sudo å‘½ä»¤å¯åŠ¨ã€‚å¦åˆ™ä¼šå¯¼è‡´æƒé™å†²çªã€æ— æ³• reload æˆ–åœæ­¢è¿›ç¨‹ç­‰é—®é¢˜ã€‚

## âœ… æ€»ç»“

| æ­¥éª¤        | æ“ä½œ                                        |
| ----------- | ------------------------------------------- |
| âœ… å®‰è£…     | `brew install nginx`                        |
| âœ… æŸ¥æ‰¾é…ç½® | `nginx -t`æŸ¥çœ‹é…ç½®è·¯å¾„                      |
| âœ… æ›¿æ¢é…ç½® | ä½¿ç”¨è½¯é“¾æ¥æ›¿æ¢ `nginx.conf`                 |
| âœ… å†™é…ç½®   | æ·»åŠ ç›‘å¬ç«¯å£ã€è‡ªå®šä¹‰è·¯å¾„å’Œä»£ç†              |
| âœ… å¯åŠ¨æœåŠ¡ | ä½¿ç”¨ `sudo nginx`æˆ– `brew services`å¯åŠ¨æœåŠ¡ |
